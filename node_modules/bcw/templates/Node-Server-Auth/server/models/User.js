import mongoose from "mongoose";
import bcrypt from "bcryptjs";
let Schema = mongoose.Schema;

let User = new Schema(
  {
    name: { type: String, required: true },
    //every email must be unique on the database
    email: { type: String, required: true, unique: true },
    hash: { type: String, required: true }
  },
  { timestamps: true }
);

//schema.methods are used to add a method to a Model instance
User.methods.validatePassword = function(password) {
  return new Promise((resolve, reject) => {
    bcrypt.compare(password, this.hash, function(err, isMatch) {
      if (err || !isMatch) {
        return reject(err);
      }
      return resolve(isMatch);
    });
  });
};

export default User;
